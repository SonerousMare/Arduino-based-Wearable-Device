#include <SPI.h>
#include <Adafruit_CircuitPlayground.h>
#include <Wire.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_LSM9DS0.h>

int switchState = 0;

Adafruit_LSM9DS0 lsm = Adafruit_LSM9DS0(1000);  // Use I2C, ID #1000
#define LSM9DS0_XM_CS 10
#define LSM9DS0_GYRO_CS 9
#define LSM9DS0_SCLK 13
#define LSM9DS0_MISO 12
#define LSM9DS0_MOSI 11

void configureSensor(void)
{
  lsm.setupAccel(lsm.LSM9DS0_ACCELRANGE_2G);
  lsm.setupMag(lsm.LSM9DS0_MAGGAIN_2GAUSS);
  lsm.setupGyro(lsm.LSM9DS0_GYROSCALE_245DPS);
}

void setup(void) 
{
  pinMode(A1, INPUT);
  pinMode(A6, OUTPUT);
#ifndef ESP8266
  while (!Serial);   
#endif
  Serial.begin(9600);
  Serial.println(F("LSM9DS0 9DOF Sensor Test")); Serial.println("");
  
  if(!lsm.begin())
  {
    Serial.print(F("Ooops, no LSM9DS0 detected ... Check your wiring or I2C ADDR!"));
    while(1);
  }
  Serial.println(F("Found LSM9DS0 9DOF"));
  
  configureSensor();
  

  Serial.println("");
}

void loop(void) 
{  
  sensors_event_t accel, mag, gyro, temp;

  lsm.getEvent(&accel, &mag, &gyro, &temp); 
  Serial.print("Magn. X: "); Serial.print(mag.magnetic.x); Serial.print(" ");
  Serial.print("  \tY: "); Serial.print(mag.magnetic.y);       Serial.print(" ");
  Serial.print("  \tZ: "); Serial.print(mag.magnetic.z);     Serial.println("  \tuT");
  
  // Calculate the magnitude
  float magMagnitude = sqrt(pow(mag.magnetic.x, 2) + pow(mag.magnetic.y, 2) + pow(mag.magnetic.z, 2));
  Serial.print("Magnitude: "); Serial.print(magMagnitude); Serial.println(" uT");

  // Control vibrating motor based on magnitude
  if (magMagnitude > 350) {
    digitalWrite(A6, HIGH);
     // Set motor pin to high
  } else {
    digitalWrite(A6, LOW); // Set motor pin to low
  }

  Serial.println("**********************\n");

  delay(250);
}
